<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skribble ‚Äî Draw & Guess</title>
  <meta name="description" content="Free multiplayer drawing and guessing game. Create a room, invite friends, and let the fun begin!">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="home-container">
    <!-- Animated background -->
    <div class="bg-orbs">
      <div class="orb orb-1"></div>
      <div class="orb orb-2"></div>
      <div class="orb orb-3"></div>
    </div>

    <main class="home-main">
      <!-- Logo -->
      <div class="logo-section">
        <h1 class="logo">
          <span class="logo-icon">‚úèÔ∏è</span>
          <span class="logo-text">skribble</span>
        </h1>
        <p class="tagline">Draw, Guess, Win!</p>
      </div>

      <!-- Player Setup Card -->
      <div class="glass-card setup-card">
        <div class="avatar-section">
          <div class="avatar-display" id="avatarDisplay">
            <div class="avatar-circle" id="avatarCircle">
              <span class="avatar-emoji" id="avatarEmoji">üòÄ</span>
            </div>
            <div class="avatar-controls">
              <button class="avatar-btn" id="prevAvatar" aria-label="Previous avatar">‚Äπ</button>
              <button class="avatar-btn" id="nextAvatar" aria-label="Next avatar">‚Ä∫</button>
            </div>
          </div>
          <div class="color-pickers">
            <button class="color-dot active" data-color="#6C5CE7" style="background:#6C5CE7"></button>
            <button class="color-dot" data-color="#00CEC9" style="background:#00CEC9"></button>
            <button class="color-dot" data-color="#FF6B6B" style="background:#FF6B6B"></button>
            <button class="color-dot" data-color="#FDCB6E" style="background:#FDCB6E"></button>
            <button class="color-dot" data-color="#55EFC4" style="background:#55EFC4"></button>
            <button class="color-dot" data-color="#E17055" style="background:#E17055"></button>
            <button class="color-dot" data-color="#A29BFE" style="background:#A29BFE"></button>
            <button class="color-dot" data-color="#FD79A8" style="background:#FD79A8"></button>
          </div>
        </div>

        <div class="input-group">
          <input type="text" id="nameInput" class="name-input" placeholder="Enter your name..." maxlength="16" autocomplete="off" spellcheck="false">
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary btn-play" id="btnPlay">
            <span class="btn-icon">üéÆ</span> Play!
          </button>
          <button class="btn btn-secondary" id="btnCreateRoom">
            <span class="btn-icon">üè†</span> Create Private Room
          </button>
        </div>

        <div class="join-section">
          <div class="divider"><span>or join a room</span></div>
          <div class="join-row">
            <input type="text" id="roomCodeInput" class="room-code-input" placeholder="Room Code" maxlength="6" autocomplete="off" spellcheck="false">
            <button class="btn btn-accent" id="btnJoinRoom">Join</button>
          </div>
        </div>
      </div>

      <!-- Error toast -->
      <div class="toast" id="errorToast">
        <span class="toast-icon">‚ö†Ô∏è</span>
        <span class="toast-message" id="errorMessage"></span>
      </div>
    </main>

    <footer class="home-footer">
      <p>Made with ‚ù§Ô∏è | A Skribbl.io Clone</p>
    </footer>
  </div>

  <script>
    // ============ AVATAR SYSTEM ============
    const avatarEmojis = ['üòÄ','üòé','ü§†','ü•≥','üòà','üëª','ü§ñ','üëΩ','ü¶ä','üê±','üê∂','üê∏','ü¶Ñ','üêß','üêº','ü¶ã','üê≤','üéÉ'];
    let currentAvatarIndex = 0;
    let currentColor = '#6C5CE7';

    const avatarEmoji = document.getElementById('avatarEmoji');
    const avatarCircle = document.getElementById('avatarCircle');

    document.getElementById('prevAvatar').addEventListener('click', () => {
      currentAvatarIndex = (currentAvatarIndex - 1 + avatarEmojis.length) % avatarEmojis.length;
      avatarEmoji.textContent = avatarEmojis[currentAvatarIndex];
      avatarCircle.style.animation = 'none';
      void avatarCircle.offsetHeight;
      avatarCircle.style.animation = 'avatarPop 0.3s ease';
    });

    document.getElementById('nextAvatar').addEventListener('click', () => {
      currentAvatarIndex = (currentAvatarIndex + 1) % avatarEmojis.length;
      avatarEmoji.textContent = avatarEmojis[currentAvatarIndex];
      avatarCircle.style.animation = 'none';
      void avatarCircle.offsetHeight;
      avatarCircle.style.animation = 'avatarPop 0.3s ease';
    });

    document.querySelectorAll('.color-dot').forEach(dot => {
      dot.addEventListener('click', () => {
        document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
        dot.classList.add('active');
        currentColor = dot.dataset.color;
        avatarCircle.style.background = `linear-gradient(135deg, ${currentColor}, ${adjustColor(currentColor, -30)})`;
      });
    });

    function adjustColor(hex, amount) {
      let r = parseInt(hex.slice(1,3), 16);
      let g = parseInt(hex.slice(3,5), 16);
      let b = parseInt(hex.slice(5,7), 16);
      r = Math.max(0, Math.min(255, r + amount));
      g = Math.max(0, Math.min(255, g + amount));
      b = Math.max(0, Math.min(255, b + amount));
      return `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}`;
    }

    // ============ HELPERS ============
    function showError(msg) {
      const toast = document.getElementById('errorToast');
      document.getElementById('errorMessage').textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function getPlayerData() {
      const name = document.getElementById('nameInput').value.trim();
      if (!name) {
        showError('Please enter a name!');
        return null;
      }
      return {
        name,
        avatar: {
          emoji: avatarEmojis[currentAvatarIndex],
          color: currentColor
        }
      };
    }

    // ============ ACTIONS ‚Äî No socket on home page! ============
    // Room creation/joining happens on the game page to avoid the
    // socket disconnect issue when navigating between pages.

    // Play button ‚Üí create room on game page
    document.getElementById('btnPlay').addEventListener('click', () => {
      const data = getPlayerData();
      if (!data) return;
      sessionStorage.setItem('playerData', JSON.stringify(data));
      sessionStorage.setItem('gameAction', 'create');
      window.location.href = '/game';
    });

    // Create private room ‚Üí same as play
    document.getElementById('btnCreateRoom').addEventListener('click', () => {
      const data = getPlayerData();
      if (!data) return;
      sessionStorage.setItem('playerData', JSON.stringify(data));
      sessionStorage.setItem('gameAction', 'create');
      window.location.href = '/game';
    });

    // Join room
    document.getElementById('btnJoinRoom').addEventListener('click', () => {
      const data = getPlayerData();
      if (!data) return;
      const code = document.getElementById('roomCodeInput').value.trim().toUpperCase();
      if (!code) {
        showError('Please enter a room code!');
        return;
      }
      sessionStorage.setItem('playerData', JSON.stringify(data));
      sessionStorage.setItem('gameAction', 'join');
      sessionStorage.setItem('joinCode', code);
      window.location.href = `/game?room=${code}`;
    });

    // Enter key on room code input
    document.getElementById('roomCodeInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('btnJoinRoom').click();
    });

    // Enter key on name input
    document.getElementById('nameInput').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') document.getElementById('btnPlay').click();
    });

    // Auto uppercase room code
    document.getElementById('roomCodeInput').addEventListener('input', (e) => {
      e.target.value = e.target.value.toUpperCase();
    });
  </script>
</body>
</html>
